# CI/CD Dockerfile â€” Minimal client binary for ephemeral tunnels
# Usage: docker run --rm ztunnel-ci http 3000 --relay wss://...

FROM rust:1.75-alpine AS builder

RUN apk add --no-cache musl-dev

WORKDIR /build
COPY . .

RUN cargo build --release -p ztunnel 2>/dev/null && \
    strip target/release/ztunnel

# Runtime: ~15MB Alpine image
FROM alpine:3.19

RUN apk add --no-cache ca-certificates

COPY --from=builder /build/target/release/ztunnel /usr/local/bin/ztunnel

ENTRYPOINT ["ztunnel"]
CMD ["--help"]
